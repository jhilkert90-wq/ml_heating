[supervisord]
nodaemon=true
logfile=/data/logs/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/data/logs

[program:ml_heating]
command=/usr/bin/python3 -m src.main
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/data/logs/ml_heating.log
stderr_logfile=/data/logs/ml_heating_error.log
environment=PYTHONPATH="/app"

[program:dashboard]
command=/bin/bash -c 'if [ -f /app/dashboard/app.py ]; then /usr/bin/python3 -m streamlit run dashboard/app.py --server.port=3001 --server.address=0.0.0.0 --server.headless=true --server.enableCORS=false --server.enableXsrfProtection=false; else echo "Dashboard not available - will be added in Phase 3" && sleep infinity; fi'
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/data/logs/dashboard.log
stderr_logfile=/data/logs/dashboard_error.log
environment=PYTHONPATH="/app"

[program:health_server]
command=/usr/bin/python3 /app/dashboard/health.py
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/data/logs/health_server.log
stderr_logfile=/data/logs/health_server_error.log
environment=PYTHONPATH="/app"

[program:health_check]
command=/bin/sh -c 'while true; do echo "$(date): ML Heating Add-on running" > /tmp/health; if [ -f /app/dashboard/app.py ]; then echo "Dashboard: Available" >> /tmp/health; else echo "Dashboard: Phase 3 Placeholder" >> /tmp/health; fi; sleep 30; done'
autostart=true
autorestart=true
stdout_logfile=/data/logs/health.log
stderr_logfile=/data/logs/health_error.log
